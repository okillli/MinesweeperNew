<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="LiMineZZsweeperIE - A modern minesweeper roguelike with quests and progression">
    <meta name="theme-color" content="#1a1a2e">

    <title>LiMineZZsweeperIE - Minesweeper Roguelike</title>

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Main Container -->
    <div id="app">
        <!-- HUD (Top Bar) - aria-live for dynamic updates -->
        <div id="hud" class="hud hidden" role="status" aria-live="polite">
            <div class="hud-left">
                <div class="stat">
                    <span class="stat-label" id="hp-label">HP:</span>
                    <span id="hp-display" class="stat-value" aria-labelledby="hp-label">3</span>
                </div>
                <div class="stat">
                    <span class="stat-label" id="mana-label">Mana:</span>
                    <span id="mana-display" class="stat-value" aria-labelledby="mana-label">0/100</span>
                </div>
                <div class="stat">
                    <span class="stat-label" id="coins-label">Coins:</span>
                    <span id="coins-display" class="stat-value" aria-labelledby="coins-label">0</span>
                </div>
            </div>
            <div class="hud-right">
                <div class="stat">
                    <span class="stat-label" id="board-label">Board:</span>
                    <span id="board-display" class="stat-value" aria-labelledby="board-label">1/6</span>
                </div>
            </div>
        </div>

        <!-- Main Menu Screen -->
        <div id="menu-screen" class="screen active">
            <div class="screen-content">
                <h1 class="title">
                    <span class="logo-lizzie">li</span><span class="logo-mine">MINE</span><span class="logo-lizzie">zz</span><span class="logo-sweeper">SWEEPER</span><span class="logo-lizzie">ie</span>
                </h1>
                <p class="subtitle">A Minesweeper Roguelike</p>

                <div class="menu-buttons">
                    <button id="start-button" class="btn btn-primary">Start Run</button>
                    <button id="collection-button" class="btn btn-secondary">Collection</button>
                    <button id="settings-button" class="btn btn-secondary">Settings</button>
                </div>

                <div class="stats-preview">
                    <p>Gems: <span id="menu-gems">0</span></p>
                    <p>Runs: <span id="menu-runs">0</span></p>
                    <p>Wins: <span id="menu-wins">0</span></p>
                </div>
            </div>
        </div>

        <!-- Quest Selection Screen -->
        <div id="quest-screen" class="screen">
            <div class="screen-content">
                <h2>Choose Your Quest</h2>
                <p class="screen-subtitle">Select a challenge to begin your run</p>
                <div id="quest-list" class="quest-list">
                    <!-- Quests will be populated by JavaScript -->
                </div>
                <button id="quest-back-button" class="btn btn-secondary">Back</button>
            </div>
        </div>

        <!-- Character Selection Screen -->
        <div id="character-screen" class="screen">
            <div class="screen-content">
                <h2>Choose Your Character</h2>
                <p class="screen-subtitle">Each character has unique abilities</p>
                <div id="character-list" class="character-list">
                    <!-- Characters will be populated by JavaScript -->
                </div>
                <button id="character-back-button" class="btn btn-secondary">Back</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <!-- Screen reader instructions (visually hidden) -->
            <div id="game-instructions" class="sr-only">
                Minesweeper game board. Use arrow keys to move cursor.
                Press Space or Enter to reveal a cell. Press F to flag a cell.
                On touch devices: tap to reveal, long-press to flag.
                Use the mode toggle button to switch tap action between reveal and flag.
            </div>

            <!-- Canvas for grid -->
            <canvas id="game-canvas"
                    role="application"
                    aria-label="Minesweeper game board"
                    aria-describedby="game-instructions"></canvas>

            <!-- Active Abilities Bar -->
            <div id="abilities-bar" class="abilities-bar hidden" role="toolbar" aria-label="Active abilities">
                <div id="ability-slots" class="ability-slots">
                    <!-- Ability buttons will be populated by JavaScript -->
                </div>
            </div>

            <!-- Input Mode Toggle (Mobile FAB) -->
            <button id="input-mode-toggle"
                    class="input-mode-toggle"
                    role="switch"
                    aria-checked="false"
                    aria-label="Tap mode: Currently in reveal mode. Tap to switch to flag mode."
                    title="Switch tap action (Reveal/Flag)">
                <span class="mode-icon" aria-hidden="true">⛏️</span>
                <span class="mode-label">REVEAL</span>
            </button>

            <!-- Debug Overlay (Press D to toggle) -->
            <div id="debug-overlay" class="debug-overlay hidden">
                <div class="debug-title">Debug Info (Press D to close)</div>
                <div class="debug-content">
                    <p>Grid: <span id="debug-grid-size">-</span></p>
                    <p>Total Cells: <span id="debug-total-cells">-</span></p>
                    <p>Config Mines: <span id="debug-config-mines">-</span></p>
                    <p>Actual Mines: <span id="debug-actual-mines">-</span></p>
                    <p>Revealed: <span id="debug-revealed">-</span></p>
                    <p>Flagged: <span id="debug-flagged">-</span></p>
                    <p class="debug-separator">--- Verification ---</p>
                    <p>Numbers Valid: <span id="debug-numbers-valid">-</span></p>
                    <p>Cell Array: <span id="debug-cell-array">-</span></p>
                </div>
            </div>
        </div>

        <!-- Shop Screen -->
        <div id="shop-screen" class="screen">
            <div class="screen-content">
                <h2>Shop</h2>
                <p class="shop-info">Choose your upgrades wisely!</p>
                <p class="shop-coins">Coins: <span id="shop-coins-display">0</span></p>

                <div id="shop-items" class="shop-items">
                    <!-- Shop items will be populated by JavaScript -->
                </div>

                <button id="shop-continue-button" class="btn btn-primary">Continue</button>
            </div>
        </div>

        <!-- Game Over Overlay (appears on top of game screen) -->
        <div id="gameover-overlay" class="gameover-overlay hidden"
             role="dialog"
             aria-modal="true"
             aria-labelledby="gameover-title"
             aria-describedby="gameover-message">
            <!-- Semi-transparent message box centered on screen -->
            <div class="gameover-message-box">
                <h2 id="gameover-title">Game Over</h2>
                <p id="gameover-message">You were defeated!</p>
                <p class="gameover-hint" aria-hidden="true">Scroll down for details ↓</p>
            </div>

            <!-- Spacer to push stats below the viewport -->
            <div class="gameover-spacer"></div>

            <!-- Stats Section (Below viewport - user scrolls to see) -->
            <div class="gameover-stats-container">
                <div class="stats-section">
                    <h2>Run Complete</h2>

                    <div class="stats-summary">
                        <h3>Run Statistics</h3>
                        <p>Boards Cleared: <span id="stat-boards">0</span></p>
                        <p>Cells Revealed: <span id="stat-cells">0</span></p>
                        <p>Coins Earned: <span id="stat-coins">0</span></p>
                        <p>Damage Taken: <span id="stat-damage">0</span></p>
                    </div>

                    <div class="rewards">
                        <h3>Rewards</h3>
                        <p class="gems-earned">+<span id="gems-earned">0</span> Gems</p>
                    </div>

                    <div class="gameover-actions">
                        <button id="gameover-newgame-button" class="btn btn-primary">New Game</button>
                        <button id="gameover-menu-button" class="btn btn-secondary">Return to Menu</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Collection Screen -->
        <div id="collection-screen" class="screen">
            <div class="screen-content">
                <h2>Collection</h2>

                <div class="collection-tabs" role="tablist" aria-label="Collection categories">
                    <button class="tab-button active" data-tab="items" role="tab" aria-selected="true" aria-controls="collection-content">Items</button>
                    <button class="tab-button" data-tab="characters" role="tab" aria-selected="false" aria-controls="collection-content">Characters</button>
                    <button class="tab-button" data-tab="achievements" role="tab" aria-selected="false" aria-controls="collection-content">Achievements</button>
                </div>

                <div id="collection-content" class="collection-content" role="tabpanel" aria-label="Collection items">
                    <!-- Collection items will be populated by JavaScript -->
                </div>

                <button id="collection-back-button" class="btn btn-secondary">Back</button>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settings-screen" class="screen">
            <div class="screen-content">
                <h2>Settings</h2>

                <div class="settings-list">
                    <!-- Difficulty Settings Section -->
                    <div class="settings-section">
                        <h3 class="settings-section-title">Difficulty</h3>

                        <div class="setting-item">
                            <label for="difficulty">Board Difficulty</label>
                            <select id="difficulty">
                                <option value="easy">Easy (Smaller boards)</option>
                                <option value="normal" selected>Normal</option>
                                <option value="hard">Hard (Larger boards)</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>

                        <!-- Custom difficulty options (shown when Custom is selected) -->
                        <div id="custom-difficulty-options" class="custom-options hidden">
                            <!-- Mode toggle: Scale vs Custom Dimensions -->
                            <div class="setting-item">
                                <label for="use-custom-dimensions">Use Exact Dimensions</label>
                                <input type="checkbox" id="use-custom-dimensions">
                            </div>

                            <!-- Scaling Mode (shown when NOT using custom dimensions) -->
                            <div id="scaling-mode-options">
                                <div class="setting-item slider-item">
                                    <label for="board-size-scale">Board Size Scale</label>
                                    <div class="slider-container">
                                        <input type="range" id="board-size-scale" min="50" max="150" value="100" step="5">
                                        <span id="board-size-value" class="slider-value">100%</span>
                                    </div>
                                </div>
                                <div class="setting-item slider-item">
                                    <label for="mine-density-scale">Mine Density Scale</label>
                                    <div class="slider-container">
                                        <input type="range" id="mine-density-scale" min="50" max="150" value="100" step="5">
                                        <span id="mine-density-value" class="slider-value">100%</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Custom Dimensions Mode (shown when using custom dimensions) -->
                            <div id="custom-dimensions-options" class="hidden">
                                <div class="setting-item number-item">
                                    <label for="custom-width">Grid Width</label>
                                    <input type="number" id="custom-width" min="6" max="30" value="10" class="number-input">
                                </div>
                                <div class="setting-item number-item">
                                    <label for="custom-height">Grid Height</label>
                                    <input type="number" id="custom-height" min="6" max="30" value="10" class="number-input">
                                </div>
                                <div class="setting-item number-item">
                                    <label for="custom-mines">Number of Mines</label>
                                    <input type="number" id="custom-mines" min="5" max="891" value="15" class="number-input">
                                </div>
                                <p class="custom-hint" id="mines-hint">Max mines: 91 (for 10×10 grid)</p>
                            </div>
                        </div>

                        <div class="setting-item">
                            <label for="starting-board">Starting Board</label>
                            <select id="starting-board">
                                <option value="1" selected>Board 1 (Tutorial)</option>
                                <option value="2">Board 2 (Easy)</option>
                                <option value="3">Board 3 (Normal)</option>
                                <option value="4">Board 4 (Hard)</option>
                                <option value="5">Board 5 (Very Hard)</option>
                                <option value="6">Board 6 (Boss)</option>
                            </select>
                        </div>

                        <!-- Preview of current settings -->
                        <div class="difficulty-preview" id="difficulty-preview">
                            <p class="preview-title">Board 1 Preview:</p>
                            <p class="preview-stats" id="preview-stats">8×8 grid, 10 mines</p>
                        </div>
                    </div>

                    <!-- Game Settings Section -->
                    <div class="settings-section">
                        <h3 class="settings-section-title">Game</h3>

                        <div class="setting-item">
                            <label for="starting-hp">Starting HP</label>
                            <select id="starting-hp">
                                <option value="1" selected>1 HP (Hard)</option>
                                <option value="2">2 HP (Medium)</option>
                                <option value="3">3 HP (Normal)</option>
                                <option value="5">5 HP (Easy)</option>
                            </select>
                        </div>

                        <div class="setting-item">
                            <label for="mode-button-position">Mode Button Position</label>
                            <select id="mode-button-position">
                                <option value="right" selected>Right (Default)</option>
                                <option value="left">Left (Left-handed)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Audio Settings Section -->
                    <div class="settings-section">
                        <h3 class="settings-section-title">Audio</h3>

                        <div class="setting-item">
                            <label for="sound-toggle">Sound Effects</label>
                            <input type="checkbox" id="sound-toggle" checked>
                        </div>
                        <div class="setting-item">
                            <label for="music-toggle">Music</label>
                            <input type="checkbox" id="music-toggle" checked>
                        </div>
                    </div>

                    <!-- Data Section -->
                    <div class="settings-section">
                        <h3 class="settings-section-title">Data</h3>
                        <div class="setting-item">
                            <button id="clear-save-button" class="btn btn-danger">Clear Save Data</button>
                        </div>
                    </div>
                </div>

                <button id="settings-back-button" class="btn btn-secondary">Back</button>
            </div>
        </div>
    </div>

    <!-- Load game scripts -->

    <!-- Data Definitions -->
    <script src="src/data/items.js"></script>
    <script src="src/data/boards.js"></script>
    <script src="src/data/quests.js"></script>
    <script src="src/data/characters.js"></script>

    <!-- Entities -->
    <script src="src/entities/Cell.js"></script>
    <script src="src/entities/Grid.js"></script>

    <!-- Systems -->
    <script src="src/systems/ItemSystem.js"></script>
    <script src="src/systems/ShopSystem.js"></script>
    <script src="src/systems/SaveSystem.js"></script>

    <!-- Visual Effects -->
    <script src="src/systems/ParticleSystem.js"></script>
    <script src="src/systems/FloatingTextSystem.js"></script>
    <script src="src/systems/EffectsManager.js"></script>

    <!-- Rendering -->
    <script src="src/rendering/CanvasRenderer.js"></script>

    <!-- Core -->
    <script src="src/core/EventBus.js"></script>
    <script src="src/core/GameState.js"></script>
    <script src="src/core/Game.js"></script>

    <!-- Main entry point -->
    <script src="src/main.js"></script>

    <!--
    Phase 2+ Files (not yet implemented):
    - src/data/constants.js, items.js, quests.js, characters.js
    - src/utils/random.js, storage.js, math.js, helpers.js
    - src/entities/Item.js, Character.js
    - src/systems/GridSystem.js, ShopSystem.js, ItemSystem.js, QuestSystem.js, ProgressionSystem.js, SaveSystem.js
    - src/rendering/UIRenderer.js, effects.js
    - src/core/StateMachine.js
    -->
</body>
</html>
